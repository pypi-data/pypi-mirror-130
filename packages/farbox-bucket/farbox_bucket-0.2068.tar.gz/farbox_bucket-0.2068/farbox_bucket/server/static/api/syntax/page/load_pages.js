// Generated by CoffeeScript 1.8.0
(function() {
  var auto_load_pages, finish_page_loading, load_more, load_next_page, next_page_number, on_page_loading;

  on_page_loading = false;

  finish_page_loading = false;

  next_page_number = 2;

  load_next_page = (function(_this) {
    return function(container_id, loading_id, callback) {
      var container_dom_id, loading_dom_id, url;
      container_dom_id = '#' + container_id;
      loading_dom_id = '#' + loading_id;
      on_page_loading = true;
      $(loading_dom_id).css('display', 'block');
      url = location.pathname + '/page/' + next_page_number + location.search;
      url = url.replace(/\/{2,}/g, '/');
      if ((typeof auto_load_page_callback !== "undefined" && auto_load_page_callback !== null) && !callback) {
        callback = auto_load_page_callback;
      }
      return $.get(url, {
        pjax: true
      }, function(data) {
        $(loading_dom_id).css('display', 'none');
        if (data.length < 20) {
          finish_page_loading = true;
        } else {
          try {
            $(container_dom_id).append(data);
          } catch (_error) {}
          next_page_number += 1;
          on_page_loading = false;
        }
        if (callback) {
          return callback();
        }
      });
    };
  })(this);

  auto_load_pages = function(container_id, loading_id, callback) {
    var bottom_diff;
    bottom_diff = $(document).height() - $(window).height() - $(window).scrollTop();
    if (bottom_diff < 80 && !on_page_loading && !finish_page_loading && location.search.indexOf('?s=') === -1) {
      return load_next_page(container_id, loading_id, callback);
    }
  };

  load_more = function() {
    var dom_id;
    if (typeof auto_load_page_container_id !== "undefined" && auto_load_page_container_id !== null) {
      dom_id = auto_load_page_container_id || 'list_container';
    } else {
      dom_id = 'list_container';
    }
    return auto_load_pages(dom_id, 'on_loading');
  };

  $(document).ready(function() {
    $(window).scroll(load_more);
    return load_more();
  });

}).call(this);
