// Generated by CoffeeScript 1.8.0
(function() {
  this.ajax_submit_installed = false;

  this.g = this;

  this.install_ajax_submit = function() {
    if (ajax_submit_installed) {
      return false;
    }
    $('form button[type=submit]').click(function(event) {
      var button_dom, extra_data, form_dom;
      event.preventDefault();
      button_dom = $(this);
      form_dom = button_dom.parents('form');
      $(this).attr("disabled", true);
      if (typeof get_form_extra_data !== "undefined" && get_form_extra_data !== null) {
        extra_data = get_form_extra_data(form_dom);
      } else {
        extra_data = {};
      }
      extra_data['ajax'] = true;
      if (typeof current_modal_click_button_value !== "undefined" && current_modal_click_button_value !== null) {
        extra_data['click_button_value'] = current_modal_click_button_value;
      }
      return form_dom.ajaxSubmit({
        data: extra_data,
        beforeSubmit: function() {
          if (Essage) {
            return Essage.show("send data to server now...");
          }
        },
        success: function(text, status_text, xhr, _form_dom) {
          var info, js_content, url_to_jump;
          button_dom.removeAttr("disabled");
          $('.essage').css('position', 'fixed');
          if (status_text === 'success') {
            if (typeof after_ajax_submit !== "undefined" && after_ajax_submit !== null) {
              after_ajax_submit();
            }
            if (text && text.indexOf('url:') === 0) {
              url_to_jump = text.slice(4);
              window.location.href = url_to_jump;
              return false;
            }
            if (text && text.indexOf('js:') === 0) {
              js_content = text.slice(3);
              eval(js_content);
              if (typeof Essage !== "undefined" && Essage !== null) {
                Essage.show("done", 2000);
                Essage.hide();
              }
              return false;
            }
            if (text && text.indexOf('info:') === 0) {
              info = text.slice(5);
              return Essage.show({
                status: "success",
                message: info
              }, 5000);
            }
            if (typeof Essage !== "undefined" && Essage !== null) {
              if (text) {
                return Essage.show({
                  status: "error",
                  message: text
                });
              } else {
                return Essage.show({
                  status: "success",
                  message: "current data submit done"
                }, 3000);
              }
            }
          } else {
            if (typeof Essage !== "undefined" && Essage !== null) {
              return Essage.show({
                status: "error",
                message: status_text
              });
            }
          }
        }
      });
    });
    g.ajax_submit_installed = true;
  };

  $(document).ready(function() {
    return install_ajax_submit();
  });

}).call(this);
