"use strict";(self.webpackChunkjlmc=self.webpackChunkjlmc||[]).push([[137],{72137:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var a=n(47458),o=n(16825),s=n(86790);const l="create-model-card",i="modify-model-card-stage",r=new Map([["plotting","Plotting"],["datacleaning","Data Cleaning"],["preprocessing","Preprocessing"],["hyperparameters","Hyperparameters"],["modeltraining","Model Training"],["modelevaluation","Model Evaluation"],["miscellaneous","Ignore"]]);var c=n(96216),d=n(19129),p=n(23706),h=(n(26946),n(66678)),m=n.n(h),u=n(56271),g=n.n(u),_=n(14456),x=n(8387),v=n(73426),w=n(7179),E=n(70938),b=n.n(E),C=n(40654),k=n.n(C),f=n(99946);const y=e=>{let t="";return Object.entries(e).forEach((([e,n])=>{if("miscellaneous"===e)return;if("modelname"===e)return void(t+=`${n.description}\n`);const a=n.description&&"string"==typeof n.description&&n.description.trim(),o=n.figures&&n.figures.length;(a||o)&&(t+=`## ${n.title}\n`),a&&(t+=`${n.description}\n`),o&&n.figures.forEach(((e,n)=>t+=`<img alt="figure${n}" src="data:image/png;base64, ${e}">\n`))})),t};var M=n(19850);const P=/<!--\s*@md-(\w*)\s*-->/,j=/<!--\s*@md-\w*\s*-->([\s\S]*)<!--\s*\/md-\w*\s*-->/;var R=n(90608);const N=(e,t)=>{setTimeout((()=>{e.deselectAll(),e.activeCellIndex=t,function(e,t=!1){const n=e.activeCell;"edit"===e.mode&&n&&(n.editor.hasFocus()||n.editor.focus()),t&&!e.node.contains(document.activeElement)&&e.node.focus()}(e),e.mode="edit",function(e,t){R.ElementExt.scrollIntoViewIfNeeded(e.node,t.node),e.deselectAll(),e.select(t),t.activate()}(e,e.activeCell)}),0)};var S=n(61209),$=n(54309);const I=({sectionName:e,sectionTitle:t,annotMap:n,updateAnnotMap:a,notebook:o,idx:s})=>n.has(e)?g().createElement(S.Z,{onClick:()=>{N(o,n.get(e).idx)}}):g().createElement(v.Popconfirm,{title:`Add a ${r.has(e)?"description":"new cell"} for ${t}?`,onConfirm:()=>{var n,l;o.model.cells.insert(s,new $.MarkdownCellModel({cell:{cell_type:"markdown",source:(n=e,l=t,`# ${l}\n\x3c!-- @md-${n} --\x3e\n\x3c!-- /md-${n} --\x3e`),metadata:{}}})),a((t=>{t.set(e,s)})),N(o,s)},okText:"Yes",cancelText:"No"},g().createElement(S.Z,null));var T=n(57119);(0,w.enableMapSet)();const W=(e,t)=>"author"===e?1:r.has(e)&&t.cell_ids.length>0?t.cell_ids[0]:0,O=k().div`
  position: relative;
  background: aliceblue;
  width: 40%;
  height: 40px;
  border-radius: 10px;
`,D=k().div`
  position: absolute;
  left: ${e=>e.left}%;
  height: 100%;
  width: 5px;
  background-color: lightskyblue;
  border-radius: 15px;
  transition: transform 0.2s, background-color 0.2s;

  &:hover {
    transform: scale(3, 1.5);
    background-color: #1890ff;
    z-index: 2;
    cursor: pointer;
  }
`,B=({notebook:e,sectionName:t,sectionContent:n,quickFix:a})=>"object"!=typeof n?null:g().createElement(g().Fragment,null,g().createElement(g().Fragment,null,g().createElement("h1",null,g().createElement(v.Tooltip,{title:n.tooltip,placement:"rightTop"},n.title," ",a)),g().createElement(b(),null,n.description),g().createElement("div",{style:{display:"block"}},"modelname"!==t&&"cell_ids"in n&&n.cell_ids.length>0?g().createElement(O,null,n.cell_ids.map(((t,n)=>g().createElement(D,{key:n,left:t/e.model.cells.length*100,onClick:()=>N(e,t-1)})))):null),"figures"in n?n.figures.map(((e,t)=>g().createElement("img",{style:{display:"block"},key:t,src:`data:image/png;base64,${e}`}))):null)),A=({notebook:e,context:t,docManager:n,ServerResponse:a,handler:o})=>{const[s,l]=(0,f.useImmer)(new Map),[i,r]=(0,f.useImmer)({});return(0,u.useEffect)((()=>{const t=(e=>{const t=new Map;if(e.model.cells){let n,a;return(0,M.each)(e.model.cells,((e,o)=>{"markdown"===e.type&&(n=e.value.text.match(P),a=e.value.text.match(j),n&&t.set(n[1],{idx:o,content:a[1]}))})),t}})(e);let n=JSON.parse(JSON.stringify(a));t.forEach(((e,t)=>{t in n&&(n[t].description=e.content)})),r((()=>n));const o="modelname";if(void 0!==n.modelname.description&&!t.has(o)){const a=e.model.cells.get(0).value;a.insert(0,"\x3c!-- @md-modelname --\x3e\n"),a.insert(a.text.length,"\n\x3c!-- /md-modelname --\x3e"),t.set(o,{idx:0,content:n.modelname.description})}l((()=>t))}),[e]),g().createElement(g().Fragment,null,g().createElement(v.Row,{style:{position:"sticky",top:10,float:"right"}},g().createElement(v.Space,null,g().createElement(v.Col,{span:6},g().createElement(v.Button,{type:"primary",onClick:()=>{o()}},"Refresh")),g().createElement(v.Col,{span:6},g().createElement(v.Button,{type:"primary",onClick:()=>{let e=[];if(Object.entries(i).map((([t,n],a)=>{n.description||["#","Miscellaneous"].includes(n.title)||e.push(n.title)})),e)v.Modal.confirm({title:"The following sections are still empty!",icon:g().createElement(T.Z,null),content:[e.join(", "),"Would you like to add the documentation before exporting?"].join(".\n"),okText:"Yes",cancelText:"No (Proceed with exporting)",onOk(){},onCancel(){const e=x.PathExt.dirname(t.path);let a=x.PathExt.basename(t.path);a=a.split(x.PathExt.extname(a))[0],a=a.split(" ").join("_"),a="card_"+a+".md";const o=x.PathExt.join(e,a);let s=n.findWidget(o,"Editor");void 0===s&&(s=n.createNew(o,"Editor")),s.context.ready.then((()=>{s.content.model.value.text=y(i)})),s.close(),n.openOrReveal(o,"Markdown Preview")}});else{const e=x.PathExt.dirname(t.path);let a=x.PathExt.basename(t.path);a=a.split(x.PathExt.extname(a))[0],a=a.split(" ").join("_"),a="card_"+a+".md";const o=x.PathExt.join(e,a);let s=n.findWidget(o,"Editor");void 0===s&&(s=n.createNew(o,"Editor")),s.context.ready.then((()=>{s.content.model.value.text=y(i)})),n.openOrReveal(o,"Markdown Preview")}}},"Export to MD")))),Object.entries(i).map((([t,n],a)=>"miscellaneous"===t?null:g().createElement(B,{key:a,notebook:e,sectionName:t,sectionContent:n,quickFix:g().createElement(I,{sectionName:t,sectionTitle:n.title,annotMap:s,updateAnnotMap:l,notebook:e,idx:W(t,n)})}))))};class F extends o.ReactWidget{constructor(e,t,n,a){super(),this._notebook=e.content,this._context=e.context,this._docManager=t,this.serverResponse=n,this.createPanelHandler=a,this.addClass("jp-ReactWidget")}onUpdateRequest(){_.render(g().createElement(A,{notebook:this._notebook,context:this._context,docManager:this._docManager,ServerResponse:this.serverResponse,handler:this.createPanelHandler}),this.node)}updateModel(e){this._notebook=m()(e.content)}render(){return g().createElement(A,{notebook:this._notebook,context:this._context,docManager:this._docManager,ServerResponse:this.serverResponse,handler:this.createPanelHandler})}}var H=n(57254);const V=/(\[model card\] stage: )[\w ]*(.*)/,q=({notebook:e})=>{const t=g().createElement(v.Menu,null,Array.from(r.entries()).map((([t,n],a)=>g().createElement(v.Menu.Item,{key:a,onClick:()=>{e.activeCell.model.metadata.set("stage",t);const a=e.activeCell.model.value.text;a.match(V)?e.activeCell.model.value.text=a.replace(V,`$1${n}$2`):e.activeCell.model.value.insert(0,`# [model card] stage: ${n}\n`)}},n))));return g().createElement(v.Dropdown,{overlay:t},g().createElement(v.Button,null,"Select stage ",g().createElement(H.Z,null)))};class J extends o.ReactWidget{constructor(e){super(),this._notebook=e.content}updateModel(e){this._notebook=m()(e.content)}render(){return g().createElement(q,{notebook:this._notebook})}}var U=n(59584);class Z extends p.StackedPanel{constructor(e,t,n,a,o){super(),this._app=e,this._docManager=t,this.id=n,this.title.label=a,this.title.closable=!0,this._createPanelHandler=o}onUpdateRequest(){this._view?this.updateView(this._context.localPath):this.createView(this._context.localPath)}setContext(e){this._context=e}setPanel(e){this._panel=e}getPopup(){return this._popup}async getData(e){const t={path:e};try{return await async function(e="",t={}){const n=U.ServerConnection.makeSettings(),a=x.URLExt.join(n.baseUrl,"jlmc",e);let o;try{o=await U.ServerConnection.makeRequest(a,t,n)}catch(e){throw new U.ServerConnection.NetworkError(e)}const s=await o.json();if(!o.ok)throw new U.ServerConnection.ResponseError(o,s.message);return s}("hello",{body:JSON.stringify(t),method:"POST"})}catch(e){console.error(`Error on POST /jlmc/hello ${t}.\n${e}`),alert("jlmc ran into errors. Generation Failed.")}}async updateView(e){this.getData(e).then((e=>{this._view=new F(this._panel,this._docManager,e,this._createPanelHandler),this._view.updateModel(this._panel),this._view.update(),this._popup=new J(this._panel),this._popup.updateModel(this._panel)}))}launchPanel(){this._popup&&(this._popup.updateModel(this._panel),new c.Popup({body:this._popup,anchor:this._panel.content.activeCell,align:"right"}).launch())}async createView(e){this.getData(e).then((e=>{this._view=new F(this._panel,this._docManager,e,this._createPanelHandler),this.addWidget(this._view),this._popup=new J(this._panel),this._view.updateModel(this._panel),this._popup.updateModel(this._panel)}))}createNew(e,t){return new d.DisposableDelegate((()=>{this.widgets&&this.widgets.forEach((e=>{e.isDisposed||e.dispose(),e=null})),this._popup.dispose()}))}}function L(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*a));return t}class G{constructor(e,t){this._app=e,this._docManager=t}createNew(e,t){let n;function a(e){e.launchPanel()}const s=()=>{t.ready.then((()=>{this._context=t;let o=x.PathExt.basename(t.path);o=o.split(x.PathExt.extname(o))[0],o=o.split(" ").join("_"),o+=".modelcard",n?n&&!n.isAttached?(n.setContext(this._context),n.setPanel(e),this._app.shell.add(n,"main",{mode:"split-right"}),this._app.shell.activateById(n.id),this._modelCardPanel=n,n.update()):n&&!n.isVisible?(n.setContext(this._context),n.setPanel(e),this._app.shell.activateById(n.id),this._modelCardPanel=n,n.update()):n&&(this._app.shell.currentWidget===n?(this._app.shell.currentWidget.dispose(),n=new Z(this._app,this._docManager,L(10),o,s),n.setContext(this._context),n.setPanel(e),this._modelCardPanel=n,this._app.commands.hasCommand(i)||(this._app.commands.addCommand(i,{label:"[Model Card] Change stage to...",execute:()=>{a(this._modelCardPanel)}}),this._app.contextMenu.addItem({command:i,selector:".jp-CodeCell"})),this._app.docRegistry.addWidgetExtension("Notebook",n),this._app.shell.add(n,"main",{mode:"split-right"}),this._app.shell.activateById(n.id),n.update()):(n.setContext(this._context),n.setPanel(e),n.update())):(n=new Z(this._app,this._docManager,L(10),o,s),n.setContext(this._context),n.setPanel(e),this._modelCardPanel=n,this._app.commands.hasCommand(i)||(this._app.commands.addCommand(i,{label:"[Model Card] Change stage to...",execute:()=>{a(this._modelCardPanel)}}),this._app.contextMenu.addItem({command:i,selector:".jp-CodeCell"})),this._app.docRegistry.addWidgetExtension("Notebook",n),this._app.shell.add(n,"main",{mode:"split-right"}),this._app.shell.activateById(n.id),n.update())}))},r=new o.ToolbarButton({tooltip:"Generate model card",className:"myButton",onClick:()=>{s()},label:"Model Card"});return e.toolbar.insertItem(0,"jupyterlabClassic",r),this._app.commands.hasCommand(l)||this._app.commands.addCommand(l,{label:"Model Card",caption:"Model Card",isVisible:()=>!1,execute:s}),r}}const Y={id:"model-card-extension",autoStart:!0,requires:[s.IDocumentManager,a.ILayoutRestorer],activate:(e,t,n)=>{console.log("JupyterLab extension jlcards is activated!");const a=new o.WidgetTracker({namespace:"model-card"});n.restore(a,{command:l,name:()=>"model-card"});const s=new G(e,t);e.docRegistry.addWidgetExtension("Notebook",s)}}}}]);