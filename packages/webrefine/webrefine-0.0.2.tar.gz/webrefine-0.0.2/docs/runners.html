---

title: Process


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/02_runners.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_runners.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Process" class="doc_header"><code>class</code> <code>Process</code><a href="https://github.com/EdwardJRoss/webrefine/tree/master/webrefine/runners.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Process</code>(<strong><code>queries</code></strong>:<code>list[Callable]</code>, <strong><code>steps</code></strong>:<code>list[Callable]</code>, <strong><code>filter</code></strong>:<code>Callable</code>)</p>
</blockquote>
<p>Process(queries: 'list[Callable]', steps: 'list[Callable]', filter: 'Callable')</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Simple-in-Memory-Runner">Simple in Memory Runner<a class="anchor-link" href="#Simple-in-Memory-Runner"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RunnerMemory" class="doc_header"><code>class</code> <code>RunnerMemory</code><a href="https://github.com/EdwardJRoss/webrefine/tree/master/webrefine/runners.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RunnerMemory</code>(<strong><code>process</code></strong>:<a href="/webrefine/runners.html#Process"><code>Process</code></a>, <strong><code>progress_bar</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RunnerCached" class="doc_header"><code>class</code> <code>RunnerCached</code><a href="https://github.com/EdwardJRoss/webrefine/tree/master/webrefine/runners.py#L68" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RunnerCached</code>(<strong><code>process</code></strong>:<a href="/webrefine/runners.html#Process"><code>Process</code></a>, <strong><code>path</code></strong>:<code>Union[str, Path]</code>, <strong><code>progress_bar</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simple-test-process">Simple test process<a class="anchor-link" href="#Simple-test-process"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In practice we'd use a something like parsel, beautifulsoup or selectolax.
However for a simple demo this has no external dependencies.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">html.parser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>

<span class="k">class</span> <span class="nc">SkeptricHTMLParser</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;post-full-title&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;title&#39;</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;byline-meta-date&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span>

    <span class="k">def</span> <span class="nf">handle_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">skeptric_filter</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">mime</span> <span class="o">==</span> <span class="s1">&#39;text/html&#39;</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">r</span>
        
<span class="k">def</span> <span class="nf">skeptric_extract</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">SkeptricHTMLParser</span><span class="p">()</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">extract</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">url</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">timestamp</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">skeptric_verify_extract</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Missing title&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Missing date&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">content</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="k">def</span> <span class="nf">skeptric_normalise</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">content</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> %B %Y&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">content</span>

<span class="kn">from</span> <span class="nn">webrefine.query</span> <span class="kn">import</span> <span class="n">WarcFileQuery</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="s1">&#39;../resources/test/skeptric.warc.gz&#39;</span>

<span class="n">skeptric_query</span> <span class="o">=</span> <span class="n">WarcFileQuery</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Test-Memory-Runner">Test Memory Runner<a class="anchor-link" href="#Test-Memory-Runner"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">skeptric_process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="n">skeptric_query</span><span class="p">],</span>
                     <span class="nb">filter</span><span class="o">=</span><span class="n">skeptric_filter</span><span class="p">,</span>
                     <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="n">skeptric_extract</span><span class="p">,</span> <span class="n">skeptric_verify_extract</span><span class="p">,</span> <span class="n">skeptric_normalise</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">RunnerMemory</span><span class="p">(</span><span class="n">skeptric_process</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">())</span>
<span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>ERROR:root:Error processing WarcFileRecord(url=&#39;https://skeptric.com/&#39;, timestamp=datetime.datetime(2021, 11, 26, 11, 28, 36), mime=&#39;text/html&#39;, status=200, path=PosixPath(&#39;../resources/test/skeptric.warc.gz&#39;), offset=17122, digest=&#39;JJVB3MQERHRZJCHOJNKS5VDOODXPZAV2&#39;) at step skeptric_verify_extract: Missing title
ERROR:root:Error processing WarcFileRecord(url=&#39;https://skeptric.com/tags/data/&#39;, timestamp=datetime.datetime(2021, 11, 26, 11, 28, 38), mime=&#39;text/html&#39;, status=200, path=PosixPath(&#39;../resources/test/skeptric.warc.gz&#39;), offset=130269, digest=&#39;R7CLAACFU5L7T5LKI5G53RZSMCNUNV6F&#39;) at step skeptric_verify_extract: Missing title
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;title&#39;: &#34;Pagination in Internet Archive&#39;s Wayback Machine with CDX&#34;,
  &#39;date&#39;: datetime.datetime(2021, 11, 23, 0, 0),
  &#39;url&#39;: &#39;https://skeptric.com/pagination-wayback-cdx/&#39;,
  &#39;timestamp&#39;: datetime.datetime(2021, 11, 26, 11, 28, 34)},
 {&#39;title&#39;: &#39;About Skeptric&#39;,
  &#39;date&#39;: datetime.datetime(2021, 10, 18, 0, 0),
  &#39;url&#39;: &#39;https://skeptric.com/about/&#39;,
  &#39;timestamp&#39;: datetime.datetime(2021, 11, 26, 11, 28, 37)},
 {&#39;title&#39;: &#39;Searching 100 Billion Webpages Pages With Capture Index&#39;,
  &#39;date&#39;: datetime.datetime(2020, 6, 11, 0, 0),
  &#39;url&#39;: &#39;https://skeptric.com/searching-100b-pages-cdx/&#39;,
  &#39;timestamp&#39;: datetime.datetime(2021, 11, 26, 11, 28, 39)},
 {&#39;title&#39;: &#39;Fast Web Dataset Extraction Worfklow&#39;,
  &#39;date&#39;: datetime.datetime(2021, 11, 21, 0, 0),
  &#39;url&#39;: &#39;https://skeptric.com/fast-web-data-workflow/&#39;,
  &#39;timestamp&#39;: datetime.datetime(2021, 11, 26, 11, 28, 39)},
 {&#39;title&#39;: &#39;Unique Key for Web Captures&#39;,
  &#39;date&#39;: datetime.datetime(2021, 11, 19, 0, 0),
  &#39;url&#39;: &#39;https://skeptric.com/key-web-captures/&#39;,
  &#39;timestamp&#39;: datetime.datetime(2021, 11, 26, 11, 28, 40)},
 {&#39;title&#39;: &#39;Hugo Readdir Error with Emacs&#39;,
  &#39;date&#39;: datetime.datetime(2021, 11, 22, 0, 0),
  &#39;url&#39;: &#39;https://skeptric.com/emacs-tempfile-hugo/&#39;,
  &#39;timestamp&#39;: datetime.datetime(2021, 11, 26, 11, 28, 40)}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can always look up an error</p>
<p>Would be nicer if everything was a string so we didn't have to handle the imports...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">webrefine.query</span> <span class="kn">import</span> <span class="n">WarcFileRecord</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">PosixPath</span>
<span class="n">WarcFileRecord</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://skeptric.com/&#39;</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span> <span class="n">mime</span><span class="o">=</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../resources/test/skeptric.warc.gz&#39;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">17122</span><span class="p">,</span> <span class="n">digest</span><span class="o">=</span><span class="s1">&#39;JJVB3MQERHRZJCHOJNKS5VDOODXPZAV2&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>WarcFileRecord(url=&#39;https://skeptric.com/&#39;, timestamp=datetime.datetime(2021, 11, 26, 11, 28, 36), mime=&#39;text/html&#39;, status=200, path=PosixPath(&#39;../resources/test/skeptric.warc.gz&#39;), offset=17122, digest=&#39;JJVB3MQERHRZJCHOJNKS5VDOODXPZAV2&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Test-Persistent-Runner">Test Persistent Runner<a class="anchor-link" href="#Test-Persistent-Runner"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="n">test_cache_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./test_skeptric_cache.sqlite&#39;</span><span class="p">)</span>
<span class="n">data_cached</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">RunnerCached</span><span class="p">(</span><span class="n">skeptric_process</span><span class="p">,</span> <span class="n">test_cache_path</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>ERROR:root:Error processing WarcFileRecord(url=&#39;https://skeptric.com/&#39;, timestamp=datetime.datetime(2021, 11, 26, 11, 28, 36), mime=&#39;text/html&#39;, status=200, path=PosixPath(&#39;../resources/test/skeptric.warc.gz&#39;), offset=17122, digest=&#39;JJVB3MQERHRZJCHOJNKS5VDOODXPZAV2&#39;) at step skeptric_verify_extract: Missing title
ERROR:root:Error processing WarcFileRecord(url=&#39;https://skeptric.com/tags/data/&#39;, timestamp=datetime.datetime(2021, 11, 26, 11, 28, 38), mime=&#39;text/html&#39;, status=200, path=PosixPath(&#39;../resources/test/skeptric.warc.gz&#39;), offset=130269, digest=&#39;R7CLAACFU5L7T5LKI5G53RZSMCNUNV6F&#39;) at step skeptric_verify_extract: Missing title
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 652 ms, sys: 28.9 ms, total: 681 ms
Wall time: 794 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">data_cached</span> <span class="o">==</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">webrefine.query</span> <span class="kn">import</span> <span class="n">CommonCrawlQuery</span><span class="p">,</span> <span class="n">WaybackQuery</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">skeptric_cc</span> <span class="o">=</span> <span class="n">CommonCrawlQuery</span><span class="p">(</span><span class="s1">&#39;skeptric.com/*&#39;</span><span class="p">,</span> <span class="n">apis</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CC-MAIN-2021-43&#39;</span><span class="p">])</span>

<span class="n">skeptric_wb</span> <span class="o">=</span> <span class="n">WaybackQuery</span><span class="p">(</span><span class="s1">&#39;skeptric.com/*&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;202103&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;202111&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">skeptric_filter_strict</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">mime</span> <span class="o">!=</span> <span class="s1">&#39;text/html&#39;</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s1">&#39;/tags/&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">url</span> <span class="ow">or</span> <span class="s1">&#39;/notebooks/&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">url</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;skeptric.com/&#39;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">r</span>

<span class="n">skeptric_process_all</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="n">skeptric_query</span><span class="p">,</span> <span class="n">skeptric_cc</span><span class="p">,</span> <span class="n">skeptric_wb</span><span class="p">],</span>
                     <span class="nb">filter</span><span class="o">=</span><span class="n">skeptric_filter_strict</span><span class="p">,</span>
                     <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="n">skeptric_extract</span><span class="p">,</span> <span class="n">skeptric_verify_extract</span><span class="p">,</span> <span class="n">skeptric_normalise</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The cached runner has to evaluate everything the first time and so is slow.</p>
<p>TODO: We need to fix the fetch progress bar (callbacks?)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> data_all = list(RunnerCached(skeptric_process_all, test_cache_path).run())
<span class="nb">len</span><span class="p">(</span><span class="n">data_all</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 8.17 s, sys: 343 ms, total: 8.51 s
Wall time: 8.49 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>882</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Cache size in MB</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_cache_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>6.1953125</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It runs much faster the second time</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> data_all_2 = list(RunnerCached(skeptric_process_all, test_cache_path).run())
<span class="k">assert</span> <span class="n">data_all</span> <span class="o">==</span> <span class="n">data_all_2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 8 s, sys: 350 ms, total: 8.35 s
Wall time: 8.29 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_cache_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

