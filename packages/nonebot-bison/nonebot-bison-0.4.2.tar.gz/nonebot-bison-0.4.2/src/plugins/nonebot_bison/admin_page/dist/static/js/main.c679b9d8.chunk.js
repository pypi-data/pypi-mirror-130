(this["webpackJsonpadmin-frontend"]=this["webpackJsonpadmin-frontend"]||[]).push([[0],{213:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},375:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(29),u=n.n(c),s=(n(213),n(24)),o=n.n(s),i=n(151),l=n(35),j=n(23),b=n(145),f=n(26),d=(n(214),{login:{login:!1,type:"",name:"",id:"123",token:""},save:function(){}}),O=Object(r.createContext)(d),h=Object(r.createContext)({platformConf:{},loaded:!1}),p=n(390),g=n(391),m=n(377),x=n(384),v=(n(215),n(92)),y=n(383),k=n(57),C=n(91),w=n(52),S=n.n(w),N="/bison/api/";function F(){return I.apply(this,arguments)}function I(){return(I=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.get("".concat(N,"global_conf"));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return P.apply(this,arguments)}function P(){return(P=Object(l.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.get("".concat(N,"auth"),{params:{token:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.get("".concat(N,"subs"));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t){return V.apply(this,arguments)}function V(){return(V=Object(l.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.get("".concat(N,"target_name"),{params:{platformName:t,target:n}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return L.apply(this,arguments)}function L(){return(L=Object(l.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.post("".concat(N,"subs"),n,{params:{groupNumber:t}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(l.a)(o.a.mark((function e(t,n,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.delete("".concat(N,"subs"),{params:{groupNumber:t,platformName:n,target:r}});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return(z=Object(l.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.a.patch("".concat(N,"subs"),n,{params:{groupNumber:t}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}S.a.interceptors.request.use((function(e){if(e.url&&e.url.startsWith(N)&&e.url!=="".concat(N,"auth")&&e.url!=="".concat(N,"global_conf")){var t=sessionStorage.getItem("token");if(!t)throw new S.a.Cancel("User not login");e.headers.Authorization="Bearer ".concat(t)}return e}),(function(e){return Promise.reject(e)})),S.a.interceptors.response.use((function(e){return e}));var A=n(194),D=n(387),R=n(388),_=n(389),G=n(202),H=n(380),J=n(54),K=n(378),U=n(89),W=n(386),Q=n(379),X=n(385),Y=n(197),Z=n.n(Y),$=n(382),ee=n(381),te=n(203),ne=n(207),re=n(6);function ae(e){var t=Object(r.useState)(e.value||[]),n=Object(j.a)(t,2),a=n[0],c=n[1],u=Object(r.useState)(!1),s=Object(j.a)(u,2),o=s[0],i=s[1],l=Object(r.useState)(""),b=Object(j.a)(l,2),f=b[0],d=b[1],O=Object(r.useState)(-1),h=Object(j.a)(O,2),p=h[0],g=h[1],m=Object(r.useState)(""),x=Object(j.a)(m,2),v=x[0],y=x[1],k=Object(r.useRef)(null),C=Object(r.useRef)(null);Object(r.useEffect)((function(){e.value&&c(e.value)}),[e.value]),Object(r.useEffect)((function(){o&&k.current.focus()}),[o]),Object(r.useEffect)((function(){-1!==p&&C.current.focus()}),[p]);var w=function(){if(f&&-1===a.indexOf(f)){var t=[].concat(Object(te.a)(a),[f]);c((function(e){return t})),e.onChange&&e.onChange(t)}i((function(e){return!1})),d((function(e){return""}))},S=function(e){y((function(t){return e.target.value}))},N=function(){var t=a.slice();t[p]=v,c((function(e){return t})),e.onChange&&e.onChange(t),g((function(e){return-1})),y((function(e){return""}))};return Object(re.jsxs)(re.Fragment,{children:[a.map((function(t,n){if(p===n)return Object(re.jsx)(ee.a,{ref:C,size:"small",value:v,onChange:S,onBlur:N,onPressEnter:w},t);var r=t.length>20,u=Object(re.jsx)(X.a,{color:e.color||"default",style:{userSelect:"none"},closable:!0,onClose:function(){return function(t){var n=a.filter((function(e){return e!==t}));c((function(e){return n})),e.onChange&&e.onChange(n)}(t)},children:Object(re.jsx)("span",{onDoubleClick:function(e){g((function(e){return n})),y((function(e){return t})),e.preventDefault()},children:r?"".concat(t.slice(0,20),"..."):t})},t);return r?Object(re.jsx)(U.a,{title:t,children:u},t):u})),o&&Object(re.jsx)(ee.a,{ref:k,type:"text",size:"small",style:{width:"78px",marginRight:"8px",verticalAlign:"top"},value:f,onChange:function(e){d(e.target.value)},onBlur:w,onPressEnter:w}),!o&&Object(re.jsxs)(X.a,{className:"site-tag-plus",onClick:function(){i((function(e){return!0}))},style:{background:"#fff",border:"dashed thin",borderColor:"#bfbfbf"},children:[Object(re.jsx)(ne.a,{})," ",e.addText||"Add Tag"]})]})}function ce(e){var t=Object(r.useState)(e.value||[]),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(r.useEffect)((function(){e.value&&c(e.value)}),[e.value]),Object(re.jsx)(re.Fragment,{children:e.disabled?Object(re.jsx)(X.a,{color:"default",children:"\u4e0d\u652f\u6301\u6807\u7b7e"}):Object(re.jsxs)(re.Fragment,{children:[0===a.length&&Object(re.jsx)(X.a,{color:"green",children:"\u5168\u90e8\u6807\u7b7e"}),Object(re.jsx)(ae,{color:"blue",addText:"\u6dfb\u52a0\u6807\u7b7e",value:a,onChange:function(t){c((function(){return t})),e.onChange&&e.onChange(t)}})]})})}function ue(e){var t=e.showModal,n=e.groupNumber,a=e.setShowModal,c=e.refresh,u=e.initVal,s=Object(r.useState)(!1),i=Object(j.a)(s,2),b=i[0],f=i[1],d=Object(r.useContext)(h).platformConf,O=Object(r.useState)(!1),p=Object(j.a)(O,2),g=p[0],m=p[1],x=Object(r.useState)({}),v=Object(j.a)(x,2),y=v[0],k=v[1],C=Object(r.useState)(!1),w=Object(j.a)(C,2),S=w[0],N=w[1],F=Q.a.useForm(),I=Object(j.a)(F,1)[0],T=Object(r.useState)(!1),P=Object(j.a)(T,2),E=P[0],V=P[1];return Object(r.useEffect)((function(){if(u&&!E){var e=u.platformName;m(d[e].hasTarget),k(d[e].categories),N(d[e].enabledTag),V(!0),I.setFieldsValue(u)}}),[u,I,d,E]),Object(re.jsx)($.a,{title:"\u6dfb\u52a0\u8ba2\u9605",visible:t,confirmLoading:b,onCancel:function(){return a(!1)},onOk:function(){I.submit(),f((function(){return!0}))},children:Object(re.jsxs)(Q.a,{form:I,labelCol:{span:6},name:"b",onFinish:function(e){var t=Object.assign({},e);"object"!==typeof t.tags&&(t.tags=[]),"object"!==typeof t.cats&&(t.cats=[]),""===t.target&&(t.target="default"),u?function(e,t){return z.apply(this,arguments)}(n,t).then((function(){f(!1),a(!1),I.resetFields(),c()})):B(n,t).then((function(){f(!1),a(!1),I.resetFields(),c()}))},children:[Object(re.jsx)(Q.a.Item,{label:"\u5e73\u53f0",name:"platformName",rules:[],children:Object(re.jsx)(H.a,{style:{width:"80%"},onChange:function(e){m((function(t){return d[e].hasTarget})),k((function(t){return d[e].categories})),N(d[e].enabledTag),d[e].hasTarget?I.setFieldsValue({targetName:"",target:""}):M(e,"default").then((function(e){console.log(e),I.setFieldsValue({targetName:e.targetName,target:""})}))},children:Object.keys(d).map((function(e){return Object(re.jsx)(H.a.Option,{value:e,children:d[e].name},e)}))})}),Object(re.jsx)(Q.a.Item,{label:"\u8d26\u53f7",name:"target",rules:[{required:g,message:"\u8bf7\u8f93\u5165\u8d26\u53f7"},{validator:function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M(I.getFieldValue("platformName"),n);case 3:if(!(r=e.sent).targetName){e.next=9;break}return I.setFieldsValue({targetName:r.targetName}),e.abrupt("return",Promise.resolve());case 9:return I.setFieldsValue({targetName:""}),e.abrupt("return",Promise.reject("\u8d26\u53f7\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u68c0\u67e5\u8d26\u53f7"));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",Promise.reject("\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()}],children:Object(re.jsx)(ee.a,{placeholder:g?"\u83b7\u53d6\u65b9\u5f0f\u89c1\u6587\u6863":"\u6b64\u5e73\u53f0\u4e0d\u9700\u8981\u8d26\u53f7",disabled:!g,style:{width:"80%"}})}),Object(re.jsx)(Q.a.Item,{label:"\u8d26\u53f7\u540d\u79f0",name:"targetName",children:Object(re.jsx)(ee.a,{style:{width:"80%"},disabled:!0})}),Object(re.jsx)(Q.a.Item,{label:"\u8ba2\u9605\u5206\u7c7b",name:"cats",rules:[{required:Object.keys(y).length>0,message:"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5206\u7c7b\u8fdb\u884c\u8ba2\u9605"}],children:Object(re.jsx)(H.a,{style:{width:"80%"},mode:"multiple",disabled:0===Object.keys(y).length,placeholder:Object.keys(y).length>0?"\u8bf7\u9009\u62e9\u8981\u8ba2\u9605\u7684\u5206\u7c7b":"\u672c\u5e73\u53f0\u4e0d\u652f\u6301\u5206\u7c7b",children:Object.keys(y).length>0&&Object.keys(y).map((function(e){return Object(re.jsx)(H.a.Option,{value:parseInt(e),children:y[parseInt(e)]},e)}))})}),Object(re.jsx)(Q.a.Item,{label:"\u8ba2\u9605Tag",name:"tags",children:Object(re.jsx)(ce,{disabled:!S})})]})})}function se(e){var t=e.setShowModal,n=e.config,a=e.currentGroupNumber,c=e.groups,u=e.showModal,s=e.reload,i=Object(r.useState)(!1),b=Object(j.a)(i,2),f=b[0],d=b[1],O=Object(r.useState)([]),h=Object(j.a)(O,2),p=h[0],g=h[1],m=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(A.a)(t),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=9;break}return c=a.value,e.next=7,B(c,n);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),r.e(e.t0);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(t,n){return e.apply(this,arguments)}}();return Object(re.jsx)(Z.a,{title:"\u590d\u5236\u8ba2\u9605",visible:u,confirmLoading:f,onCancel:function(){return t(!1)},onOk:function(){0===p.length?G.b.error("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u76ee\u6807\u7fa4"):(d(!0),m(p,n).then((function(){return d(!1),t(!1),s()})))},children:Object(re.jsx)(H.a,{mode:"multiple",onChange:function(e){return g(e)},style:{width:"80%"},children:Object.keys(c).filter((function(e){return e!==a})).map((function(e){return Object(re.jsx)(H.a.Option,{value:e,children:"".concat(e," - ").concat(c[e].name)},e)}))})})}function oe(e){var t=e.groupNumber,n=e.config,a=e.reload,c=e.groupSubscribes,u=Object(r.useContext)(h),s=Object(r.useState)(!1),o=Object(j.a)(s,2),i=o[0],l=o[1],b=Object(r.useState)(!1),f=Object(j.a)(b,2),d=f[0],O=f[1],p=u.platformConf[n.platformName];return Object(re.jsxs)(J.a,{span:8,children:[Object(re.jsx)(K.a,{title:"".concat(p.name," - ").concat(n.targetName),actions:[Object(re.jsx)(U.a,{title:"\u7f16\u8f91",children:Object(re.jsx)(D.a,{onClick:function(){O((function(e){return!e}))}})}),Object(re.jsx)(U.a,{title:"\u6dfb\u52a0\u5230\u5176\u4ed6\u7fa4",children:Object(re.jsx)(R.a,{onClick:function(){l((function(e){return!e}))}})}),Object(re.jsx)(W.a,{title:"\u786e\u5b9a\u8981\u5220\u9664 ".concat(p.name," - ").concat(n.targetName),onConfirm:function(e,t,n){return function(){(function(e,t,n){return q.apply(this,arguments)})(e,t,n).then((function(){a()}))}}(t,n.platformName,n.target||"default"),children:Object(re.jsx)(U.a,{title:"\u5220\u9664",children:Object(re.jsx)(_.a,{})})})],children:Object(re.jsxs)(Q.a,{labelCol:{span:4},children:[Object(re.jsx)(Q.a.Item,{label:"\u8ba2\u9605\u5e10\u53f7",children:p.hasTarget?n.target:Object(re.jsx)(X.a,{color:"default",children:"\u65e0\u5e10\u53f7"})}),Object(re.jsx)(Q.a.Item,{label:"\u8ba2\u9605\u7c7b\u578b",children:Object.keys(p.categories).length>0?n.cats.map((function(e){return Object(re.jsx)(X.a,{color:"green",children:p.categories[e]},e)})):Object(re.jsx)(X.a,{color:"default",children:"\u4e0d\u652f\u6301\u7c7b\u578b"})}),Object(re.jsx)(Q.a.Item,{label:"\u8ba2\u9605Tag",children:p.enabledTag?n.tags.length>0?n.tags.map((function(e){return Object(re.jsx)(X.a,{color:"green",children:e},e)})):Object(re.jsx)(X.a,{color:"blue",children:"\u5168\u90e8\u6807\u7b7e"}):Object(re.jsx)(X.a,{color:"default",children:"\u4e0d\u652f\u6301Tag"})})]})}),Object(re.jsx)(se,{setShowModal:l,reload:a,currentGroupNumber:t,showModal:i,config:n,groups:c}),Object(re.jsx)(ue,{showModal:d,setShowModal:O,groupNumber:t,refresh:a,initVal:n})]},"".concat(n.platformName,"-").concat(n.target))}function ie(e){var t=Object(r.useState)({}),n=Object(j.a)(t,2),a=n[0],c=n[1],u=Object(r.useState)(!1),s=Object(j.a)(u,2),o=s[0],i=s[1],l=Object(r.useState)(""),b=Object(j.a)(l,2),f=b[0],d=b[1],O=function(){(function(){return E.apply(this,arguments)})().then((function(e){c((function(t){return e}))}))};Object(r.useEffect)((function(){O()}),[e.tab]);if(0===Object.keys(a).length)return Object(re.jsx)(v.a,{});for(var h=[],p=function(){var e,t=m[g],n=a[t];h.push(Object(re.jsx)(y.a.Panel,{header:Object(re.jsxs)("span",{children:["".concat(t," - ").concat(n.name),Object(re.jsx)(k.a,{style:{float:"right"},onClick:(e=t,function(t){i((function(e){return!0})),d(e),t.stopPropagation()}),children:"\u6dfb\u52a0"})]}),children:Object(re.jsx)(C.a,{gutter:[{xs:8,sm:16,md:24,lg:32},{xs:8,sm:16,md:24,lg:32}],align:"middle",children:n.subscribes.map((function(e,n){return Object(re.jsx)(oe,{groupNumber:t,config:e,groupSubscribes:a,reload:O},n)}))})},t))},g=0,m=Object.keys(a);g<m.length;g++)p();return Object(re.jsxs)("div",{children:[Object(re.jsx)(y.a,{children:h}),Object(re.jsx)(ue,{groupNumber:f,showModal:o,refresh:O,setShowModal:function(e){return i((function(t){return e}))}})]})}function le(){var e=Object(r.useContext)(O).login,t=Object(r.useState)("manage"),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(re.jsxs)(m.a,{style:{minHeight:"100vh"},children:[Object(re.jsxs)(m.a.Sider,{className:"layout-side",children:[Object(re.jsx)("div",{className:"user"}),Object(re.jsxs)(x.a,{mode:"inline",theme:"dark",defaultSelectedKeys:[a],onClick:function(e){var t=e.key;return c(t)},children:[Object(re.jsx)(x.a.Item,{icon:Object(re.jsx)(p.a,{}),children:"\u8ba2\u9605\u7ba1\u7406"},"manage"),"admin"===e.type&&Object(re.jsx)(x.a.Item,{icon:Object(re.jsx)(g.a,{}),children:"\u67e5\u770b\u65e5\u5fd7"},"log")]})]}),Object(re.jsx)(m.a.Content,{children:Object(re.jsx)("div",{style:{margin:"24px",background:"#fff",minHeight:"640px"},children:"manage"===a?Object(re.jsx)(ie,{tab:a}):null})})]})}function je(){var e=Object(f.g)().code,t=Object(r.useState)(Object(re.jsx)("div",{children:"Logining..."})),n=Object(j.a)(t,2),a=n[0],c=n[1],u=Object(r.useContext)(O).save;return Object(r.useEffect)((function(){var t=function(){var t=Object(l.a)(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T(e);case 2:200===(n=t.sent).status?(u({login:!0,type:n.type,name:n.name,id:n.id,token:n.token}),c((function(e){return Object(re.jsx)(f.a,{to:{pathname:"/admin"}})})),sessionStorage.setItem("token",n.token)):c((function(e){return Object(re.jsx)("div",{children:"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u83b7\u53d6\u8fde\u63a5"})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[e,u]),a}n(374);function be(){var e=Object(r.useContext)(O),t=e.login,n=e.save;return t.login?Object(re.jsx)(le,{}):Object(re.jsxs)("div",{children:["not login",Object(re.jsx)("button",{onClick:function(){return n({login:!0,type:"admin",name:"",id:"123",token:""})},children:"1"})]})}var fe=function(){var e=Object(r.useState)(d.login),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({platformConf:{},loaded:!1}),u=Object(j.a)(c,2),s=u[0],p=u[1];return Object(r.useEffect)((function(){var e=function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:t=e.sent,p((function(e){return Object(i.a)(Object(i.a)({},t),{},{loaded:!0})}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),Object(re.jsx)(O.Provider,{value:{login:n,save:function(e){return a((function(t){return e}))}},children:Object(re.jsx)(h.Provider,{value:s,children:s.loaded&&Object(re.jsx)(b.a,{basename:"/bison",children:Object(re.jsxs)(f.d,{children:[Object(re.jsx)(f.b,{path:"/auth/:code",children:Object(re.jsx)(je,{})}),Object(re.jsx)(f.b,{path:"/admin/",children:Object(re.jsx)(be,{})})]})})})})},de=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,392)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,u=t.getTTFB;n(e),r(e),a(e),c(e),u(e)}))};u.a.render(Object(re.jsx)(a.a.StrictMode,{children:Object(re.jsx)(fe,{})}),document.getElementById("root")),de()}},[[375,1,2]]]);
//# sourceMappingURL=main.c679b9d8.chunk.js.map